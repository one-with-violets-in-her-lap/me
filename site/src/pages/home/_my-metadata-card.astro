---
import ghostImage from '@/assets/images/ghost.png'

import { Image } from 'astro:assets'
import {
    GithubIcon,
    MailIcon,
    MinusIcon,
    MusicIcon,
    SquareIcon,
    TwitterIcon,
    XIcon,
} from 'lucide-react'
import { Button } from '@/components/ui/button'
import type { MyMetadata } from '@/lib/content'
import type { LastFmTrack } from '@/lib/last-fm'

interface Props {
    metadata: MyMetadata
    lastTrackListened: LastFmTrack | null
}

const { metadata, lastTrackListened } = Astro.props
---

<div
    class="absolute top-1/2 -translate-1/2 left-1/2 group max-w-[400px] min-w-70 w-full max-lg:top-2/4"
>
    <div
        id="scannerContainer"
        class="opacity-0 absolute left-1/3 -translate-x-1/2 bottom-0 translate-y-full max-lg:-top-60 max-lg:left-1/2 max-lg:bottom-auto flex items-start gap-x-4"
    >
        <!-- Scanner light -->
        <div
            class="absolute bottom-0 right-7 w-40 bg-foreground/40 blur-xl h-8 scanner-light"
        >
        </div>

        <!-- Scanner rays -->
        <div
            class="bg-gradient-to-b from-foreground/80 to-foreground/5 to-90% h-30 w-px origin-top ray-1"
        >
        </div>

        <div
            class="bg-gradient-to-b from-foreground/60 to-foreground/10 to-90% h-30 w-px origin-top ray-2"
        >
        </div>

        <div
            class="bg-gradient-to-b from-foreground/70 to-foreground/5 to-90% h-30 w-px origin-top ray-3"
        >
        </div>

        <div
            class="bg-gradient-to-b from-foreground/80 to-foreground/5 to-90% h-30 w-px origin-top ray-4"
        >
        </div>
    </div>

    <div
        id="infoCardUnderLayer"
        class="absolute w-full h-full bg-background/30 border backdrop-blur-xl rounded-xl -left-5 -bottom-5 transform-[scale(0)]"
    >
    </div>

    <div
        id="infoCard"
        class="relative p-8 max-sm:p-4 w-full bg-background/40 border backdrop-blur-xl rounded-xl font-mono text-lg transform-[scale(0)]"
    >
        <header class="flex items-center gap-x-4.5 mb-3.5">
            <div
                class="bg-foreground/3 border rounded-lg w-16 h-16 flex items-center gap-x-3 justify-center"
            >
                <Image
                    src={ghostImage}
                    alt="Ghost pixel art"
                    width={54}
                    height={43}
                    class="h-8 w-10"
                />
            </div>

            <dl>
                <dt class="inline font-bold">Status:</dt>

                <dd class="inline">{metadata.personStatus}</dd>
            </dl>
        </header>

        <dl class="mb-6">
            <div class="mb-2">
                <dt class="inline font-bold">Health:</dt>

                <dd class="inline">{metadata.health}/100</dd>
            </div>

            <div>
                <dt class="inline font-bold">Age:</dt>

                <dd class="inline">{metadata.age}</dd>
            </div>
        </dl>

        {
            lastTrackListened && (
                <a href={lastTrackListened.url} target="_blank">
                    <div class="text-sm border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50 rounded-md w-full p-3 flex items-center gap-x-3.5 mb-3">
                        <MusicIcon strokeWidth={1} className="shrink-0" />
                        {lastTrackListened.artist['#text']} - {lastTrackListened.name}
                    </div>
                </a>
            )
        }

        <div class="flex items-center gap-x-2">
            <a
                target="_blank"
                href="https://github.com/one-with-violets-in-her-lap"
                aria-label="Github profile"
            >
                <Button
                    size="icon"
                    variant="outline"
                    className="hover:cursor-pointer"
                    aria-label="Open Github"
                >
                    <GithubIcon />
                </Button>
            </a>

            <a
                target="_blank"
                href="https://twitter.com/strawmans"
                aria-label="Twitter profile"
            >
                <Button
                    size="icon"
                    variant="outline"
                    className="hover:cursor-pointer"
                    aria-label="Open Twitter"
                >
                    <TwitterIcon />
                </Button>
            </a>

            <a
                target="_blank"
                href="mailto:sleep.posted514@passinbox.com"
                aria-label="Mail"
            >
                <Button
                    size="icon"
                    variant="outline"
                    className="hover:cursor-pointer"
                    aria-label="Open mail"
                >
                    <MailIcon />
                </Button>
            </a>
        </div>

        <div class="absolute top-2 right-2 flex items-center gap-x-1">
            <Button size="icon" variant="ghost" className="w-6 h-6">
                <MinusIcon />
            </Button>

            <Button size="icon" variant="ghost" className="w-6 h-6">
                <SquareIcon />
            </Button>

            <Button size="icon" variant="ghost" className="w-6 h-6">
                <XIcon />
            </Button>
        </div>
    </div>
</div>

<script>
    import { animate } from 'motion'

    animate(
        '#infoCardUnderLayer',
        {
            scale: 1,
        },
        { duration: 0.2, delay: 1.1 },
    )

    animate(
        '#scannerContainer',
        { opacity: 1 },
        {
            duration: 0.3,
            onComplete() {
                animate(
                    '#scannerContainer',
                    { opacity: 0, y: -70, x: 40, scale: 0.4 },
                    { duration: 0.3, delay: 0.4 },
                )
            },
        },
    )

    animate(
        '#infoCard',
        {
            scale: 1,
        },
        { duration: 0.4, type: 'spring', delay: 1.14 },
    )
</script>

<style>
    .ray-1 {
        animation: ray-1-rotation 0.4s linear 0s infinite alternate both;
    }

    .ray-2 {
        animation: ray-2-rotation 0.5s linear 0.1s infinite alternate both;
    }

    .ray-3 {
        animation: ray-3-rotation 0.3s linear 0s infinite alternate both;
    }

    .ray-4 {
        animation: ray-4-rotation 0.6s linear 0s infinite alternate both;
    }

    .scanner-light {
        animation-name: scanner-light-vertical-movement;
        animation-duration: 0.3s;
        animation-iteration-count: 4;
        animation-direction: alternate;
    }

    @keyframes ray-1-rotation {
        0% {
            transform: rotate(43deg);
        }

        100% {
            transform: rotate(20deg);
        }
    }

    @keyframes ray-2-rotation {
        0% {
            transform: rotate(22deg);
        }

        100% {
            transform: rotate(0deg);
        }
    }

    @keyframes ray-3-rotation {
        0% {
            transform: rotate(5deg);
        }

        100% {
            transform: rotate(-20deg);
        }
    }

    @keyframes ray-4-rotation {
        0% {
            transform: rotate(-15deg);
        }

        100% {
            transform: rotate(-27deg);
        }
    }

    @keyframes scanner-light-vertical-movement {
        from {
            transform: translateY(60px);
        }

        to {
            transform: translateY(0px);
        }
    }
</style>
